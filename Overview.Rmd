---
title: "Who do we think we are?"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
author: "Kelly Tall"
date: "9/11/2020"


output: 
        html_document:
                df_print: paged  
                toc: true
                toc_float: true     
                fig_caption: true 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(lubridate)
library(tidyverse)
library(DataExplorer)
library(plotly)
library(scales)
library(GGally)
library(ggraph)
library(tidygraph)
library(ggalluvial)
library(wesanderson)



# names(wes_palettes)

colours_wp <- wes_palette("Cavalcanti1", 5)

gender <- wes_palettes$Darjeeling1

colours_gender <- gender[c(2,4)]

colours_5 <- wes_palette("Darjeeling1", 5)



custom_theme <-  theme(
                        panel.grid.major.x = element_line(colour = "lightgrey", size=0.25),
                        # panel.background = element_rect(fill=("#e5e5e5")),
                        panel.background = element_blank(),
                        strip.background = element_blank(),
                        axis.ticks = element_line(colour = "lightgrey", size = 0.25),
                        # axis.line.x = element_line(colour = "lightgrey", size=0.25),
                        axis.line.x = element_blank())


# all data matched together- all updated as of 8th September 



all_data_import <- read_csv("all_data.csv") 

all_data <- all_data_import %>% 
  mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(award_comb = factor(award_comb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
  mutate(division = factor(division, levels = c("G", "M", "HG", "HM", "HP"))) %>% 
  ungroup()



        

##reoving anon recipients
# all_data <- read_csv("all_data.csv") %>% 
#   mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
#         mutate(award_comb = factor(award_comb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
#     mutate(division = factor(division, levels = c("G", "M", "HG", "HM", "HP"))) %>% 
#   ungroup()


multiple_honours_list <- all_data %>% 
  group_by(name) %>% 
  add_tally() %>% 
  filter(n>1) %>% 
  ungroup()
  

multiple_honours_list_individials <- all_data %>% 
  group_by(name) %>% 
  tally() %>% 
  filter(n>1) %>% 
  ungroup()
  



##fxing up naming issues and flattening ultiple awards to one record where earliest award date is used as honours_date and highest level is award level
recipient_import <- read_csv("recipient.csv")

recipient <- recipient_import %>% 
  ungroup() %>% 
  mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(award_comb = factor(award_comb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
    mutate(division = factor(division, levels = c("G", "M", "HG", "HM", "HP"))) %>% 
  ungroup()



# all recipients with WP page

# View(wikipedia)
wikipedia_import <- read_csv("wikipedia.csv")


wikipedia <- wikipedia_import %>% 
  mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(award_comb = factor(award_comb, levels = c("ADK", "AC", "AO", "AM", "OAM"))) %>% 
    mutate(division = factor(division, levels = c("G", "M", "HG", "HM", "HP"))) %>% 
  ungroup() 
        
post_wikipedia_awards_import <- read_csv("post_wikipedia_awards.csv")



post_wikipedia_awards <- post_wikipedia_awards_import %>% 
  mutate(state = factor(state, levels = c("NSW", "VIC", "QLD", "SA", "TAS", "WA", "ACT", "NT", "Other"))) %>% 
        mutate(award_comb = factor(award_comb, levels = c("ADK", "AC", "AO", "AM", "OAM")))

```

### Research Questions

1. Does the Order of Australia honours list follow Wikipedia articles or do Wikipedia articles follow the honours?

2. Are there differences in this trend by gender?

3. Are there differences in this trend for different honours categories/levels?

4. Are there differences in this trend by state / location?

#### Background to Australian Honours System

The Order of Australia honours system was established in 1975, and has the following levels:

1. Dame/Knight(ADK) (1976-1983 and 2014-2015 only)
3. Companion (AC)
4. Officer (AO)
5. Member (AM)
6. Medal (OAM)

More information about the Order of Australia can be found here: https://en.wikipedia.org/wiki/Order_of_Australia.

Awards are issued with the following divisions:

1. General (G): awarded to Australian Citizens 
2. Military (M): warded to Australian Military
3. Honourary: General (HG) and Military (HM) awards can also be issued to non-citizens as honourary awards. A new distinction was created recently to honour permanent-residents. These used to be indicated as "HG", but are now indicated by "HP".

People can receive multiple Order of Australia honours in their lifetime. People can have their awards terminated by the Council, or return or refuse their awards.  Some awards are issued or recorded as anonymous on the honours Database.

### Data used in analysis


The data used in this analysis is based on:

1. <b>The Order of Australia list</b> that is maintained by the Office of Prime Minister and Cabinet and found here: https://honours.pmc.gov.au/honours/search.

	This data set was provided by Alex Lum, and included the honour recipient’s gender. Some gender information was obtained from the Office of Prime Minister and Cabinet, and records with no informaiton were completed by Alex. Records awarded anonymously have no gender information recorded against them.


2. <b>Wikipedia articles</b> linked to Order of Australia recipients and their creation date. This was last extracted from wikidata on 7th November, 2020. From this a list of wikipedia article IDs were collected, and these were used to collect the article creation date.


The two data sets were joined using the honours ID as a match. Those without an hounours ID in the data set extracted from wikidata tended to be listed as “anonymous”, or had a terminated award. Some of these records were able to be matched with an honours ID, but those not were excluded from the final data set. It would be possible to match these records manually at a future date, but for the purpose of this analysis these twenty or so records are not included.  Some of the anonymus or terminated honours also had no "award date" and these have been excluded from any of the analysis that uses date of award. 


### Dataset characteristics



<!-- #### 1. Anonymous Awards - <b>TO UPDATE</b> -->

<!-- Of the `r nrow(all_data)` honours issued since 1975, there are UPDATE that are listed as being issued to an "anonymous" recipient. The reasons why an honour is listed as anonymous could be as follows;  -->
<!-- * The recipient has requested anonynmity -->
<!-- * Their honour has been withdrawn by the council -->
<!-- * the recipient has refused, or returned their honour -->

<!-- Records from the PMO dataset that are listed as anonymous or teminated awards are imcomplete. Anonymous awards have only been if there has been an honour date, and a wikipedia page and a page creation date. If the record is missing the Honours date, they have been excluded from the dataset.  -->


#### 1. Multiple Awards

Of these `r nrow(all_data)` records, there are `r nrow(multiple_honours_list_individials)` individuals who have received more than one honour, and these account for `r nrow(multiple_honours_list)` individual honours. In order to account for multiple honour dates connecting to one wikipedia article and page creation date we have used the date of the <i>earliest award</i>. When referring to the individuals honour level, we use the most <i>recent honour</i>. 

For example, Angus Houston has received four honours. His earliest honour was an AM in 1990, and his most recent was a Knighthood in 2015. His wikipedia page was created in 2005. The table below illustrates his records extracted from the data set that contains all honours records.

```{r angusMultiple, eval=TRUE, echo=FALSE, fig.width=1}

angusExample <- all_data %>% 
  select(name, award_comb, honours_date, wp_creation_date) %>% 
  filter(name == "Angus Houston")
  

angusExample
```

The table below illustrates his record extracted from the data set based on individual recipients. It shows that his honour level refers to his most recent honour in 2015 and his first award date refers to the first honour he received in 1990. 


```{r angusSingle, eval=TRUE, echo=FALSE, fig.width=1}

angusExample2 <- recipient %>% 
  filter(name == "Angus Houston") %>% 
  select(name, award_comb, first_honours_date, wp_creation_date) 
  
angusExample2

```

<!-- To make it clear for the reader and what data set we are using, refer to the chart footer. "All Honours" refers to <i>honours</i> issued, noting that an individual can hold multiple honours.  "All Recipients" refers to the <i>individuals or people</i> receiving awards and is usually used when looking at connections to wikipedia. -->


#### 2. Award Divisions 

As outlined above, honours are issued with different divisions, and the breakdown is displayed below

```{r eval=TRUE, echo=FALSE}

division <- recipient %>% 
  select(division) %>% 
  group_by(division) %>% 
  tally()
division

divisionNA <- recipient %>% 
  select(division) %>% 
  filter(is.na(division)) 
  

```

The HG and HM division is only held by 121 recipients, but some of them we can assume would have a wikipedia page whether they have an order of Australia or not. For example, Jacques Cousteau, Jerry Lewis, or Mother Theresa are all honorary recipients of an Order of Australia. There are some people though who have received honary awards whose "emminence" is linked to Australia, such as Jill Kerr, Joern Utzon and Googie Withers, and who also have a wikipedia article. Because of this, all of the honourary records have been left in the data set.

Please note there are `r nrow(divisionNA)` honours issued without a Division recorded on the PMO database. Many of these appear to be military honours from who they are awared to and the description.




#### 3. Date calculations

The Australian Honors system began in 1975, and wikipedia was established on 15 January 2001. In order to calclate the time difference bewteen the award date and the wikipedia creation date, any award issued before 15 Jan 2001, has a "start date" of 15 January 2001. The table below shows the recipients first honour date (first_honours_date), the date the time difference is calculted on (new_honours_date), the date their wikipedia entry was created, and the difference in time from honour to page creation. 

<b>A.D Hope</b> received their award in 1981. The earliest a wikpedia page could be created for them is 2001, and their page was created in 2004, so the difference is three years. Looking further down <b>Aaron Kierney</b> had a page created for them in 2012, and they received their honours in 2020. The time difference is -8 years, meaning their page was created 8 years <i>before</i> they received their honours. We can also see that number of days and weeks f=differemce has been calculated. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

date_calcs <- wikipedia %>% 
  select(name, first_honours_date, new_honours_date, wp_creation_date, time_diff, week_diff, year_diff) %>% 
        head()

date_calcs


honours_num <- recipient %>% 
  ungroup() %>% 
        select(wikipedia_page)

page_num <- recipient %>% 
        select(wikipedia_page) %>% 
  ungroup() %>% 
  filter(wikipedia_page=="Yes") 


prop_honour <- recipient %>% 
        select(wikipedia_page) %>% 
        add_tally() %>% 
        rename(total =n) %>% 
        group_by(wikipedia_page, total) %>% 
        tally() %>% 
        mutate(prop = n/total)

prop_wp <- recipient %>% 
        select(wikipedia_page) %>% 
        add_tally() %>% 
        rename(total =n) %>% 
        group_by(wikipedia_page, total) %>% 
        tally() %>% 
        mutate(prop = n/total) %>% 
  filter(wikipedia_page=="Yes") %>% 
  select(prop)

```

### Addressing the research Questions 

#### How many honours recipients have a wikipedia Page?


The Order of Australia data set represents a group of indviduals who have been recognised for service and therefore could be considered "notable". Understanding broadly the proportion of these people who also have a wikipedia page, helps us understand the representation of noted Australians on this platform. This section looks at the number of wikipedia pages written for Order recipients overall, and through different filters of gender and order level.

Looking at all honours recipients as a whole, there is only a small proportion of them that have a wikipedia page. From `r nrow(recipient)` recipients of an Order of Australia, there are `r nrow(page_num)` who have a wikipedia page which is `r percent(prop_wp$prop)`.   

<i>(Please note the charts in this section show all <b>recipients</b> of an Order of Australia. If they have received multiple awards, we are only including their first award issued so it matches with one page created for them. The creation of the wikipedia page may not have occurred in the same year as the honour, but simply indicates if they have a page or not)</i>

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


honours_num <- recipient %>% 
        select(wikipedia_page)

page_num <- recipient %>% 
        select(wikipedia_page)


prop_honour <- recipient %>% 
        select(wikipedia_page) %>% 
        add_tally() %>% 
        rename(total =n) %>% 
        group_by(wikipedia_page, total) %>% 
        tally() %>% 
        mutate(prop = n/total)

prop_wp <- recipient %>% 
        select(wikipedia_page) %>% 
        add_tally() %>% 
        rename(total =n) %>% 
        group_by(wikipedia_page, total) %>% 
        tally() %>% 
        mutate(prop = n/total) %>% 
  filter(wikipedia_page=="Yes") %>% 
  select(prop)

prop_honour_chart <-  ggplot(prop_honour, aes(wikipedia_page, prop, fill=wikipedia_page,
                              text = paste(percent(prop)))) +
  geom_col()+
   labs(title="Proportion of Honours recipients who have a wikipedia page",
       x="Order of Australia recipients", y="Proportion of honour recipients") +
  scale_fill_manual(values=colours_wp)+
  scale_y_continuous(labels = percent)+
  custom_theme
  
t <- list(
        
  family = "Helvetica",
  size = 14)

m <- list(
  l = 50,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)

chart1 <- ggplotly(prop_honour_chart, tooltip = 'text') 



chart1 %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.1, text = "All recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-5,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)

```


Over time the number of honours issued each year has increased. The line represents the average number of reward recipients who have a page, which is around 121 for each year.  In more recent years, there has been a higher number of recipients who have wikipedia pages, as the number of awards increases. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pages_over_time <- recipient %>% 
        select(honours_year, honours_date, wikipedia_page) %>% 
        filter(!is.na(honours_year)) %>% 
  group_by(honours_year) %>% 
        add_tally(name = "totalByYear") %>% 
        # filter(honours_date >= "2001-01-15") %>% 
  group_by(honours_year, wikipedia_page) %>% 
  add_tally(name = "totalByPage") %>% 
  mutate(yearProp=(totalByPage/totalByYear)) %>% 
  group_by(honours_year, wikipedia_page, totalByYear, totalByPage, yearProp) %>% 
  summarise()

pages_over_time_mean <- all_data %>% 
  filter(wikipedia_page=="Yes") %>% 
  select(honours_year) %>% 
  group_by(honours_year) %>% 
  add_tally() %>%
  ungroup() %>% 
  add_tally(mean(n))


pages_over_time_chart <- ggplot(pages_over_time)+
  geom_col(aes(honours_year, totalByPage, group=wikipedia_page, group=1, text=paste(honours_year,":", totalByPage), fill=wikipedia_page))+
  custom_theme+
  geom_hline(data=pages_over_time_mean, aes(yintercept = nn))+
  labs(title="Number of honours over time with/without wikipedia article", 
             x="Year of Honours Award", y="Number of Honours")+
  scale_fill_manual(values=colours_wp)+
  geom_segment(x = 2001, xend=2001, y=0, yend=2000, linetype="dotted", size=0.3, colour="slategray")+
  annotate(geom="text", x=2001, y=2050, label="Wikipedia Begins")

ggplotly(pages_over_time_chart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  


  
```

While the absolute numbers of recipients with wikipedia pages has gone up over time, the proportion of pages created remains relatively steady. The average is around 11.5% of honours that have a page created in their name, 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

prop_average <- recipient %>% 
  select(honours_year, honours_date, wikipedia_page) %>% 
        filter(!is.na(honours_year)) %>% 
  group_by(honours_year) %>% 
        add_tally(name = "totalByYear") %>% 
        # filter(honours_date >= "2001-01-15") %>% 
  group_by(honours_year, wikipedia_page) %>% 
  add_tally(name = "totalByPage") %>% 
  mutate(yearProp=(totalByPage/totalByYear)) %>% 
  group_by(honours_year, wikipedia_page, totalByYear, totalByPage, yearProp) %>% 
  summarise() %>% 
  ungroup() %>% 
  filter(wikipedia_page=="Yes") %>% 
  tally(mean(yearProp))
  


pages_over_time_prop <- ggplot(pages_over_time, aes(honours_year, yearProp, group=wikipedia_page, text=paste(honours_year,":", percent(yearProp, 2))))+
 geom_col(aes(fill=wikipedia_page))+
  geom_hline(data=prop_average, aes(yintercept = n))+
  custom_theme+
  labs(title="Proportion of honours recipients over time with/without wikipedia article", 
             x="Year of Honours Award", y="Proportion of Honours")+
  scale_fill_manual(values=colours_wp)+
  scale_y_continuous(labels = percent) +
  geom_segment(x = 2001, xend=2001, y=0, yend=1.02, linetype="dotted", size=0.3, colour="slategray")+
  annotate(geom="text", x=2001, y=1.05, label="Wikipedia Begins")



ggplotly(pages_over_time_prop, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  

```

Focussing on just the proportion of recipients who have received an honour each year and have a wikipedia page, we can see that over time the number of those with pages has slighlty trended below the average.

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pages_over_time_prop_subset <- ggplot(subset(pages_over_time, wikipedia_page=="Yes"), aes(honours_year, yearProp, group=wikipedia_page, text=paste(honours_year,":", percent(yearProp, 2))))+
 geom_col(fill="#02401B")+
  geom_hline(data=prop_average, aes(yintercept = n))+
  custom_theme+
  labs(title="Proportion of honours recipients over time with wikipedia article", 
             x="Year of Honours Award", y="Proportion of Honours")+
  scale_fill_manual(values=colours_wp)+
  scale_y_continuous(labels = percent)+
  geom_smooth(method="lm")+
  geom_segment(x = 2001, xend=2001, y=0, yend=0.25, linetype="dotted", size=0.3, colour="slategray")+
  annotate(geom="text", x=2001, y=0.26, label="Wikipedia Begins")



ggplotly(pages_over_time_prop_subset, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)

```


Different levels of the order of Australia though have different notability requirements. The current highest level of the Order is AC, and recipients demonstrate eminence in their field. An AO has demonstrated "distinguished service". AMs are issued to those demonstrating "exceptional service", and an OAM is gven to those who demonstrate "service worthy or a particular recognition". 
A wikipedia page can be created for someone who is "worthy of notice". We can hypothesise the higher the Order level, the more likely a recipient is to have a wikipedia page.

The first chart below shows the numbers receieving different levels each year, and the second chart shows proportions. The numbers of both honours and levels, and proportions have not remained fixed over the years. 


```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}

award_level_all <- recipient %>% 
  select(award_comb, honours_year) %>% 
  group_by(honours_year) %>% 
  add_tally(name = "total") %>% 
  group_by(award_comb, honours_year) %>% 
  add_tally(name = "total_honours") %>% 
  mutate(prop = total_honours / total) %>% 
  group_by(award_comb, honours_year, total_honours, prop) %>% 
  summarise()

award_level_all_chart <- ggplot(award_level_all, aes(honours_year, total_honours, fill=award_comb, text=paste(honours_year,award_comb,"n=", total_honours))) +
  geom_col()+
  geom_segment(x = 2001, xend=2001, y=0, yend=2000, linetype="dotted", size=0.3, colour="slategray")+
  annotate(geom="text", x=2001, y=2050, label="Wikipedia Begins")+
  custom_theme+
  labs(title="Number of honour levels awarded over time", 
             x="Year of Honours Award", y="Number of Honour Levels")+
    scale_fill_manual(values=colours_5)
  


ggplotly(award_level_all_chart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  

```


```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}


award_level_prop_chart <- ggplot(award_level_all, aes(honours_year, prop, fill=award_comb, text=paste(honours_year,award_comb,"n=", percent(prop, 2)))) +
  geom_col()+
  custom_theme+
  labs(title="Proportion of honour levels awarded over time", 
             x="Year of Honours Award", y="Number of Honour Levels")+
  scale_fill_manual(values=colours_5)+
  scale_y_continuous(labels = percent)+
  geom_segment(x = 2001, xend=2001, y=0, yend=1.05, linetype="dotted", size=0.3, colour="slategray")+
  annotate(geom="text", x=2001, y=1.06, label="Wikipedia Begins")


ggplotly(award_level_prop_chart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  


```


As hypothesised the higher the award, the more likely you are to have a wikipedia page. All 19 Dames and Knights have a page, while 85% (n=504) of ACs have page from a total of n=591. There are 3,160 recipients of an AO, and 38% of them have a wikipedia page. This means there are still n=1947 holders of an AO that do not have a wikipedia page. 13% of the holders of an AM, and 4% of those wth an OAM have a wikipedia page.


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pagePropAward <- recipient %>% 
        select(award_comb, wikipedia_page) %>% 
        group_by(award_comb) %>% 
        add_tally(name="total") %>% 
        ungroup() %>% 
        group_by(award_comb, wikipedia_page, total) %>% 
        tally(name="subtotal") %>% 
        mutate(prop=subtotal/total)

pagePropAwardChart <- ggplot(pagePropAward, aes(award_comb, prop, fill=wikipedia_page,
                                                text = paste(percent(prop)))) +
        geom_bar(position="fill", stat="identity") +
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by highest award received", 
             x="Order of Australia (membership levels)", y="Proportion of recipients") +
        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours_wp)


t <- list(
  family = "Helvetica",
  size = 14)

ggplotly(pagePropAwardChart, tooltip = 'text') %>% 
  layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,330",
                showarrow = F, xref='paper', yref='paper',
                xanchor='right', yanchor='auto', xshift=1, yshift=-5,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)

```
Since the inception of the Orer of Australia the number of women receiving an honour has been rising over time.

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}

gender_split <- recipient %>% 
  select(honours_year, gender) %>% 
  filter(gender!="U") %>% 
  group_by(honours_year) %>% 
  add_tally(name="total") %>% 
  group_by(honours_year, gender) %>% 
  add_tally(name="total_gender") %>% 
  group_by(honours_year, gender,total, total_gender) %>% 
  summarise() %>% 
  mutate(prop=total_gender/total)


gender_split_chart <- ggplot(gender_split, aes(honours_year, total_gender, fill=gender, text=paste(honours_year, gender, ":",total_gender)))+
  geom_col()+
  custom_theme+
  labs(title="Number of honours awarded over time split by gender", 
             x="Year of Honours Award", y="Number of Honour Levels")+
  scale_fill_manual(values=colours_gender)+
  geom_segment(x = 2001, xend=2001, y=0, yend=2000, linetype="dotted", size=0.3, colour="slategray")+
  annotate(geom="text", x=2001, y=2100, label="Wikipedia Begins")

  

ggplotly(gender_split_chart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  
```

While the number has been increasing, there is still a lower proportion of women who receive an honour. For the awards issued so far in 2020, 42% of the awards went to women.

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}

gender_split_prop_chart <- ggplot(gender_split, aes(honours_year, prop, fill=gender, text=paste(honours_year, gender, ":",percent(prop, 3))))+
  geom_col()+
  custom_theme+
        labs(title="Proportion of honours by gender", 
                    x="Year of Honours Award", y="Proportion")+
        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours_gender)+
  geom_segment(x = 2001, xend=2001, y=0, yend=1.04, linetype="dotted", size=0.3, colour="slategray")+
  annotate(geom="text", x=2001, y=1.07, label="Wikipedia Begins")


ggplotly(gender_split_prop_chart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  

```
On average of all the mean rececing an honour each year, 71 will also have a wikipedia page, whereas for women it's 26.  

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

gender_split_page <- recipient %>% 
  select(honours_year, gender, wikipedia_page) %>% 
  filter(gender!="U") %>% 
  group_by(honours_year, gender, wikipedia_page) %>% 
  tally() %>% 
  group_by(gender, n) %>% 
  group_by(wikipedia_page, gender) %>% 
  mutate(mean=mean(n))


gender_split_page_subset <- recipient %>% 
  select(honours_year, gender, wikipedia_page) %>% 
  filter(gender!="U") %>%
  filter(wikipedia_page=="Yes") %>% 
  group_by(honours_year, gender, wikipedia_page) %>% 
  tally() %>% 
  group_by(gender, n) %>% 
  group_by(wikipedia_page, gender) %>% 
  mutate(mean=mean(n))


gender_diff_wp <- ggplot(gender_split_page, aes(honours_year, n, fill=wikipedia_page, text=paste(honours_year, gender, ":", n)))+
  geom_col()+
  facet_wrap(~gender)+
  geom_hline(data=gender_split_page_subset, aes(yintercept = mean))+
  custom_theme+
  scale_fill_manual(values=colours_wp)+
  labs(title="Number of award recipients that have a wikipedia article page by Gender", subtitle = "Line represents total proportion to highlight differences",
             x="Year of Honour", y="Number of recipients") +
  geom_segment(x = 2001, xend=2001, y=0, yend=1500, linetype="dotted", size=0.04, colour="slategray")+
  annotate(geom="text", x=2001, y=1550, label="WP begins", size=3)



m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)        



t <- list(
  family = "Helvetica",
  size = 14)




gender_diff_wp_plot <- ggplotly(gender_diff_wp, tooltip="text")

gender_diff_wp_plot[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
gender_diff_wp_plot[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

gender_diff_wp_plot%>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients n=41,330", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  

```

While the total proportion of recipients is lower, as are the numbers of women wo have wikipedia pages, there is a higher proportion of women with wikipedia pages who have receievd ACs and slightly more for women who have receievd AOs. This may be the result of specific campaigns to create more pages for notable women in Australia?   

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pagePropGenderAward <- recipient %>% 
  ungroup() %>% 
  filter(gender!="U") %>% 
              select(gender, award_comb, wikipedia_page) %>% 
        group_by(gender, award_comb) %>% 
        add_tally(name="total") %>% 
  
        group_by(gender, award_comb, wikipedia_page) %>% 
        add_tally(name="subtotal") %>% 
        mutate(prop=subtotal/total) %>% 
        group_by(gender, award_comb, wikipedia_page, prop) %>% 
        summarise()



pagePropGenderAwardChart <- ggplot(pagePropGenderAward, aes(gender, prop, fill=wikipedia_page,text = paste(percent(prop)))) +
        geom_bar(position="fill", stat="identity") +
        custom_theme+
        labs(title="Honour Levels: Proportion of award recipients that have a wikipedia article page by Gender", 
             x="Order of Australia (membership levels)", y="Proportion of recipients") +

        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours_wp)+
        facet_wrap(~award_comb)

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)        



t <- list(
  family = "Helvetica",
  size = 14)

# str(test[['x']][['layout']][['annotations']]) 



test <- ggplotly(pagePropGenderAwardChart, tooltip="text")

test[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
test[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

test %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients with allocated Gender n=41,309", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)



```

Compared to the total averages we can see the difference in proportions of women's and men's pages, with the lines representing the total proportional average for each honours level. 

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

pageAverageTotal <- recipient %>% 
        ungroup() %>% 
        filter(gender!="U") %>% 
        select(gender, award_comb, wikipedia_page) %>% 
        group_by(award_comb) %>% 
        add_tally(name = "totalHonour") %>% 
        group_by(award_comb, wikipedia_page) %>% 
        add_tally(name = "totalWP") %>% 
        mutate(totalProp=totalWP/totalHonour) %>% 
        group_by(award_comb,gender) %>% 
                add_tally(name="totalGender") %>% 
                group_by(award_comb, wikipedia_page, gender) %>% 
                add_tally(name="totalWPGender") %>% 
                mutate(totalWPProp = totalWPGender/totalGender) %>% 
        group_by(award_comb,gender, wikipedia_page, totalProp, totalWPProp) %>% 
        summarise(n = n()) %>% 
        filter(wikipedia_page=="Yes")
        
        
 
pageAverageGenderAwardChart <- ggplot(pageAverageTotal, aes(gender, totalWPProp, fill=gender, text = paste(percent(totalWPProp)))) +
        geom_col() +
        geom_hline(aes(yintercept = totalProp))+
        custom_theme+
        labs(title="Proportion of award recipients that have a wikipedia article page by Gender", subtitle = "Line represents total proportion to highlight differences",
             x="Order of Australia (membership levels)", y="Proportion of recipients") +

        scale_y_continuous(labels = percent)+
        scale_fill_manual(values=colours_gender)+
        facet_wrap(~award_comb) 

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

t <- list(
  family = "Helvetica",
  size = 14)

chart4 <- ggplotly(pageAverageGenderAwardChart, tooltip="text")

chart4[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
chart4[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

chart4 %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients with allocated Gender n=41,309", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)


award_pre_post_day_mean <- wikipedia %>% 
  select(time_diff, honours_year) %>%
  group_by(time_diff) %>% 
  tally(name="total") %>% 
  na.omit %>% 
  mutate(mean = mean(total)) %>% 
  group_by(mean) %>% 
  summarise()


```



#### Do pages follow honours, or do honours follow pages?

Whether an award issued in a given year has a page or not tells us proportions of recipients that have a page, but it hides details on whether the wikipedia page was created for the recipient before or after they received their Order of Australia.

The below analysis looks at the difference in time between honour and page creation date. 

The first chart shows the amount of time by day, between receieving the award and when their wikipedia page was created. There are a few different peaks shown, with the highest being twenty pages created on day zero, or the day that a person receives their award.  (The chart is quite pale as there are many frequency counts per day, but it's possible to brush over the chart with your mouse to highlight a particular area.) The average page creation each day is `r (round(award_pre_post_day_mean$mean, 2))` and on day zero it is 20.

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}


award_pre_post_day <- wikipedia %>% 
  select(time_diff, honours_year) %>%
  group_by(time_diff) %>% 
  tally(name="total") %>% 
  na.omit %>% 
  mutate(mean = mean(total)) %>% 
  group_by(time_diff, total, mean) %>% 
  summarise()

award_pre_post_day_chart <-  ggplot(award_pre_post_day, aes(time_diff, total, text=paste('Difference:', time_diff, "days, n=", total))) +
        geom_col(fill="black") +
  custom_theme +
        labs(title="Difference in time between award and wikipedia page creation by day", 
             x="Days Difference between honour and award", y="Number of wikipedia pages created") +
  theme(panel.grid.major.x = element_blank())
  # geom_hline(aes(yintercept = mean))

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   



ggplotly(award_pre_post_day_chart, tooltip="text") %>% 
  layout(font=t, 
         title = list(text = paste0('Difference in time between award and wikipedia page creation by day',
                                    '<br>',
                                    '<sup>',
                                    'Negative numbers are those who have page created <i>before</i> honour, and postive have page created <i>after</i> honour',
                                    '</sup>')),
         annotations = 
           list(x = 1, y = -0.13, text = "All Recipients with wikipedia page n=4,452", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)     

```

Rolling the daily increments up to seven day increments, shows the frequencies a little clearer, with 47 pages created on week 0, which is the highest number for page creation.

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}


award_pre_post_week <- wikipedia %>% 
  select(week_diff) %>%
  group_by(week_diff) %>% 
  tally(name="total") %>% 
  mutate(mean(total))



award_pre_post_week_chart <-  ggplot(award_pre_post_week, aes(week_diff, total, text=paste('Difference:', week_diff, "weeks, n=", total))) +
        geom_col(fill="#02401B") +
  custom_theme +
        labs(title="Difference in time between award and wikipedia page creation by week", 
             x="Week Difference between honour and award", y="Number of wikipedia pages created") +
  theme(panel.grid.major.x = element_blank())

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   



ggplotly(award_pre_post_week_chart, tooltip="text") %>% 
  layout(font=t, 
         title = list(text = paste0('Difference in time between award and wikipedia page creation',
                                    '<br>',
                                    '<sup>',
                                    'Negative numbers are those who have page created <i>before</i> honour, and postive have page created <i>after</i> honour',
                                    '</sup>')),
         annotations = 
           list(x = 1, y = -0.13, text = "All Recipients with wikipedia page n=4452", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)     

```

Rolling the time increments up to a year, shows us that while there is a peak of 209 pages created over the year the award is received, there is a peak for all award recipients to have a page created between 3 and seven years after receieving their honour. 

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}


award_pre_post <- wikipedia %>% 
  select(year_diff) %>%
  group_by(year_diff) %>% 
  tally(name="total") 



award_pre_post_chart <-  ggplot(award_pre_post, aes(year_diff, total, text=paste('Difference:', year_diff, "years, n=", total))) +
        geom_col(fill="#02401B") +
  custom_theme +
        labs(title="Difference in time between award and wikipedia page creation", 
             x="Years Difference between honour and award", y="Number of recipients")

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   



ggplotly(award_pre_post_chart, tooltip="text") %>% 
  layout(font=t, 
         title = list(text = paste0('Difference in time between award and wikipedia page creation by year',
                                    '<br>',
                                    '<sup>',
                                    'Negative numbers are those who have page created <i>before</i> honour, and postive have page created <i>after</i> honour',
                                    '</sup>')),
         annotations = 
           list(x = 1, y = -0.13, text = "All Recipients with wikipedia page n=4,452", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)     

```
This analysis though may be misleading, as we are including all honours issued since the start of the Order. We can exclude all those awards received before the start of wikipedia on Januray 15 2001 so we give all pages an "equal chance" of having a page created for them without any lag.

Once we remove all honours issued before the start of wikipedia, the distrbution skews towards pages being created before receiving an honour, with a peak of 198 pages created the year of receiving an honour.

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}


award_pre_post <- post_wikipedia_awards %>% 
  select(year_diff) %>%
  group_by(year_diff) %>% 
  tally(name="total") 



award_pre_post_chart <-  ggplot(award_pre_post, aes(year_diff, total, text=paste('Difference:', year_diff, "years, n=", total))) +
        geom_col(fill="#02401B") +
  custom_theme +
        labs(title="Difference in time between award and wikipedia page creation", 
             x="Years Difference between honour and award", y="Number of recipients")

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   



ggplotly(award_pre_post_chart, tooltip="text") %>% 
  layout(font=t, 
         title = list(text = paste0('Difference in time between award and wikipedia page creation (post wikipedia only)',
                                    '<br>',
                                    '<sup>',
                                    'Negative numbers are those who have page created <i>before</i> honour, and postive have page created <i>after</i> honour',
                                    '</sup>')),
         annotations = 
           list(x = 1, y = -0.13, text = "All Recipients after 15 Jan 2001 with wikipedia page n=2528", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)     



```
Rolling this data out to a weekly level, we can see that there is a noticeable spike in page creation of 47 compared to other weeks. The average number of pages created each week is 2.2, and while there are other peaks that are above this average, the week of an award being announced appears to prompt the most page creations.

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}


award_pre_post <- post_wikipedia_awards %>% 
  select(week_diff) %>%
  group_by(week_diff) %>% 
  tally(name="total") %>% 
  mutate(mean = mean(total)) 




award_pre_post_chart <-  ggplot(award_pre_post, aes(week_diff, total, text=paste('Difference:', week_diff, "years, n=", total))) +
        geom_col(fill="#02401B") +
  geom_hline(aes(yintercept = mean))+
  custom_theme +
        labs(title="Difference in time between award and wikipedia page creation", 
             x="Weeks Difference between honour and award", y="Number of recipients")+
  theme(panel.grid.major.x = element_blank())

m <- list(
  l = 75,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   



ggplotly(award_pre_post_chart, tooltip="text") %>% 
  layout(font=t, 
         title = list(text = paste0('Difference in time between award and wikipedia page creation (post wikipedia only)',
                                    '<br>',
                                    '<sup>',
                                    'Negative numbers are those who have page created <i>before</i> honour, and postive have page created <i>after</i> honour',
                                    '</sup>')),
         annotations = 
           list(x = 1, y = -0.13, text = "All Recipients after 15 Jan 2001 with wikipedia page n=2,528", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
         autosize=F,
         width=800, 
         height=500,
         margin=m)     



```

Looking at number of pages created each week by award level, the below chart shows via colour the different frequencies of page creation 52 weeks before and after an honour is received. The intensity of colour means more page creation activity, and this shows that over this period there is more activity at week 0. This peak at week 0 is higher than the average number of pages created for each honors level. For AOs the average number of ages reated was 1.3, and for the week that honours are announced it rises to 18. Likewise for ACs the average is 1.1 and for the week honours are announced it is at 9, and for AMs the average is 1.4 and at honours week it is 14. 

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}
week_diffAllYears2 <- post_wikipedia_awards %>%
  filter(award_comb!="ADK") %>%
  select(week_diff, award_comb) %>% 
  group_by(week_diff, award_comb) %>% 
  tally() %>% 
  group_by(award_comb) %>% 
  mutate(median = median(n)) %>% 
  mutate(mean = mean(n)) %>% 
    group_by(week_diff, award_comb) %>% 
  filter(week_diff<52 & week_diff>-52)

week_diffAllYearChartLevel2 <- ggplot(week_diffAllYears2, aes(week_diff, award_comb, fill=n, text=paste("week", week_diff, ":", n)))+
  geom_tile() +
  custom_theme+
  scale_fill_distiller(type="seq", direction=1, na.value="black", palette="OrRd")+
  labs(title="Time of wikipedia  page creation for those who received honours after 15 Jan 2001", 
             x="weeks before or after award page is created", y="Number of pages / honour type")


ggplotly(week_diffAllYearChartLevel2, tooltip="text") %>% 
  layout(font=t, 
         title = list(text = paste0('Weekly difference in time between award and wikipedia page creation (post wikipedia only)',
                                    '<br>',
                                    '<sup>',
                                    'Showing 52 weeks prior and post award week.',
                                    '</sup>')),
         annotations = 
           list(x = 1, y = -0.13, text = "All Recipients w. WP page receiving award post-wikipedia 6mnths before or after n=223", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  

```

Looking at gender, men have an average of 1.8 pages created for them every week, while for women it's 1.4. Over the week of the honours announcements, the numbers of pages created a much higher, with men having 29 pages, and women 18. The week of honours announcements appears to be a week with increaed page creation activity. 

```{r echo=FALSE, message=FALSE, fig.width=12, warning=FALSE}
week_diffAllYears2 <- post_wikipedia_awards %>%
  filter(gender!="U") %>%
  select(week_diff, gender) %>% 
  group_by(week_diff, gender) %>% 
  tally() %>% 
  group_by(gender) %>% 
  mutate(median = median(n)) %>% 
  mutate(mean = mean(n)) %>% 
    group_by(week_diff, gender) %>% 
  filter(week_diff<52 & week_diff>-52)

week_diffAllYearChartLevel2 <- ggplot(week_diffAllYears2, aes(week_diff, gender, fill=n, text=paste("week", week_diff, ":", n)))+
  geom_tile() +
  custom_theme+
  scale_fill_distiller(type="seq", direction=1, na.value="black", palette="OrRd")+
  labs(title="Time of wikipedia page creation for those who received honours after 15 Jan 2001", 
             x="weeks before or after award page is created", y="Number of pages / honour type")


ggplotly(week_diffAllYearChartLevel2, tooltip="text") %>% 
  layout(font=t, 
         title = list(text = paste0('Weekly difference in time between award and wikipedia page creation (post wikipedia only)',
                                    '<br>',
                                    '<sup>',
                                    'Showing 52 weeks prior and post award week.',
                                    '</sup>')),
         annotations = 
           list(x = 1, y = -0.13, text = "All Recipients w. WP page receiving award post-wikipedia 6mnths before or after n=223", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)  

```

#### Rate of page creation for honours recipients

The below chart shows a cumulative total of wikipedia pages created for those who hold an Order of Australia over time. There is a jump in cumulative page creation after 2005, and another visible jump around 2011.


```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


cumPageDiff <- wikipedia %>% 
       select(wp_creation_date) %>% 
        group_by(wp_creation_date) %>% 
        tally(name="total") %>% 
        mutate(cumPages = cumsum(total)) %>% 
        mutate(cumpagesDiff = total - first(total), 
               cumpagesDiffPercent = cumpagesDiff/ - first(total)*100)



cumPageChart <- ggplot(cumPageDiff, aes(wp_creation_date, cumPages, group=1, text=paste(wp_creation_date,":",cumPages))) +
        geom_line(colour="#02401B") +
        custom_theme+
        labs(title="Daily cumulative page creation of honours recipients", 
             x="Date of Page creation", y="Number of pages") +
  geom_segment(x = as.numeric(as_date("2001-01-15")), xend=as.numeric(as_date("2001-01-15")), y=0, yend=3800, linetype="dotted", size=0.3, colour="slategrey")+
  scale_x_date(limits = as_date(c("2001-01-01", "2020-08-01")))+
  annotate(geom="text", x = as_date("2002-04-01"), y=4000, label="Wikipedia Begins")
  

  # annotate(geom="text", x=as_date(2001-01-01), y=3900, label="Wikipedia Begins")


m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

ggplotly(cumPageChart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients with WP page n=4423", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     
```


In order to see the peaks and drops more clearly, pages have been aggregated to a year level. Using yearly numbers and adding in a trend line, we can see that 2005 and 2006 saw an above-average amount of pages created, and smaller peaks in 2011, and 2014.  There has been though, a general decline since the peak of page creation in 2005-2006. This decline

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


cumPageyear_diff <- wikipedia %>% 
       select(wp_creation_year) %>% 
        group_by(wp_creation_year) %>% 
        filter(!is.na(wp_creation_year)) %>% 
        tally(name="total") %>% 
        ungroup() %>% 
        mutate(cumPages = cumsum(total)) %>% 
        mutate(pagesDiffStart = total - first(total), 
               # cumpagesDiffPercent = cumpagesDiff/ first(total)*100,
               cumpagesDiffPercentYOY = (total- lag(total))/lag(total))

cumPageChartYear <- ggplot(cumPageyear_diff, aes(wp_creation_year, total, text=paste(wp_creation_year,": ", total), group=1)) +
        geom_smooth(method=lm, level=0.90, alpha=0.3, size=.5)+
         geom_line(colour="#02401B", width=2) +
        # geom_smooth()+
        # scale_fill_manual(values=colours)+
        custom_theme+
        # scale_y_continuous(labels = percent)+
        labs(title="Yearly page creation", 
             x="Date of Page creation", y="Number of pages")+
  geom_segment(x = 2001, xend=2001, y=0, yend=500, linetype="dotted", size=0.3, colour="slategrey")+
  # scale_x_date(limits = as_date(c("2001-01-01", "2020-08-01")))+
  annotate(geom="text", x = 2002.5, y=520, label="Wikipedia Begins")
  

m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

ggplotly(cumPageChartYear, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients with WP page n=4423", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)     

```
Looking at the rate of pages created versus the number of honours for all honours that were received after 15 Jan 2001, the below chart shows the number of honours each year against the number of new wikipedia pages created for those with honours 


The lines are moving appart from one and other over time. As honours increases, the number of pages created for people with an Order of Australia is decreasing. 
```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}


        
        
honour_v_page_honours3 <- recipient %>% 
  filter(pre_post_wikipedia=="Post") %>% 
       select(new_honours_year) %>% 
  group_by(new_honours_year) %>% 
tally(name="honours_n") %>% 
  rename(year = new_honours_year)

honour_v_page_wiki3 <- recipient %>% 
       select(wikipedia_creation_year) %>% 
  drop_na() %>% 
  group_by(wikipedia_creation_year) %>% 
tally(name="wiki_n") %>% 
  rename(year=wikipedia_creation_year)
  

 

honour_v_wiki_comparison_chart <- left_join(honour_v_page_honours3, honour_v_page_wiki3, by="year")


honour_v_page_chart <- ggplot(honour_v_wiki_comparison_chart) +
  
  geom_point(aes(year, honours_n, text=(paste("honours", year, honours_n))), colour="#D8B70A")+
  geom_line(aes(year, honours_n ), colour="#D8B70A")+
  geom_point(aes(year, wiki_n, text=(paste("wiki pages", year, wiki_n))),  colour="#02401B")+
  geom_line(aes(year, wiki_n), colour="#02401B")+
  # geom_line(data=honour_v_page_wiki, aes(wikipedia_creation_year, n, group=1), colour="#ea5455")+
  custom_theme+
        labs(title="Honours awarded v wikipedia page creation", 
             x="Year", y="Number of pages")+
  geom_segment(x = 2001, xend=2001, y=0, yend=2000, linetype="dotted", size=0.3, colour="slategrey")+
  annotate(geom="text", x = 2002.5, y=2100, label="Wikipedia Begins")
  

  
m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

ggplotly(honour_v_page_chart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients since 15 Jan 2015 n=24701", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)    

```
The chart below shows the difference between the two points at each time period.
```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}

honour_v_wiki_comparison_diff<- honour_v_wiki_comparison_chart %>% 
  mutate(diff= honours_n - wiki_n ) 
  
  

honour_v_wiki_comparison_diff_chart <- ggplot(honour_v_wiki_comparison_diff, aes(x=year, text=paste(year, ":", diff )))+
  custom_theme+
  geom_linerange(aes(ymin=wiki_n, ymax=honours_n), colour="#02401B", size=3)+
  labs(title="Honours awarded v wikipedia page creation (difference)", 
             x="Year", y="Number of pages")+
  geom_segment(x = 2001, xend=2001, y=0, yend=2000, linetype="dotted", size=0.3, colour="slategrey")+
  annotate(geom="text", x = 2002.5, y=2100, label="Wikipedia Begins")
  

m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

ggplotly(honour_v_wiki_comparison_diff_chart, tooltip="text") %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients since 15 Jan 2015 n=24701", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)    
```

#### Gender and page creation

Looking at page creation for all people who recievd an honour and have a wikipedia page, there were slightly more pages created for men than women before an award was receieved.  Potentially the recogition of an order prompts page creation for women?

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
gender_before_after  <-  wikipedia %>% 
  
  filter(gender!="U") %>% 
  mutate(before_after = case_when(time_diff >=0 ~ "on or after honours",
                                  time_diff<0 ~ "before Honours")) %>%
  mutate(before_after = factor(before_after, levels = c("before Honours","on or after honours"))) %>% 
  group_by(gender) %>% 
  add_tally() %>% 
  group_by(gender, before_after, n) %>% 
  tally() %>% 
  filter(!is.na(before_after)) %>% 
  mutate(prop = nn/n)


total_before_after  <-  wikipedia %>% 
  
  filter(gender!="U") %>% 
  mutate(before_after = case_when(time_diff >=0 ~ "on or after honours",
                                  time_diff<0 ~ "before Honours")) %>%
  mutate(before_after = factor(before_after, levels = c("before Honours","on or after honours"))) %>% 
  add_tally() %>% 
  group_by(before_after, n) %>% 
  tally() %>% 
  filter(!is.na(before_after)) %>% 
  mutate(prop = nn/n) %>% 
  filter()

gender_before_after_chart <- ggplot(gender_before_after, aes(gender, prop, fill=gender, text = percent(prop))) +
  geom_col() +
  facet_wrap(~before_after)+
  geom_hline(data=total_before_after, aes(yintercept = prop))+
  custom_theme+
  scale_fill_manual(values=colours_gender)+
  scale_y_continuous(labels = percent)+
        labs(title="Proportion of pages created before or after honour (by gender)", 
             x="Gender", y="Proportion Number of pages")


  m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

  
gender_before_after_chart_format <- ggplotly(gender_before_after_chart, tooltip="text")

gender_before_after_chart_format[['x']][['layout']][['annotations']][[2]][['x']] <- -.09
gender_before_after_chart_format[['x']][['layout']][['annotations']][[1]][['y']] <- -.1

gender_before_after_chart_format %>% layout(font=t, 
         annotations = 
           list(x = 1, y = -0.25, text = "All Recipients with wikipedia page & coded M/F n=4443", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)





```

```{r eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE}
gender_before_after_post_wp  <-  post_wikipedia_awards %>% 
  filter(gender!="U") %>% 
  select(time_diff, pre_post_wikipedia, gender) %>% 
  filter(pre_post_wikipedia=="Post") %>% 
  mutate(before_after = case_when(time_diff >=0 ~ "on or after honours",
                                  time_diff<0 ~ "before Honours")) %>%
  mutate(before_after = factor(before_after, levels = c("before Honours","on or after honours"))) %>% 
  group_by(gender) %>% 
  add_tally() %>% 
  group_by(gender, before_after, n) %>% 
  tally() %>% 
  filter(!is.na(before_after)) %>% 
  mutate(prop = nn/n)


total_before_after_post_wp  <-  post_wikipedia_awards %>% 
  filter(gender!="U") %>% 
  filter(pre_post_wikipedia=="Post") %>% 
  mutate(before_after = case_when(time_diff >=0 ~ "on or after honours",
                                  time_diff<0 ~ "before Honours")) %>%
  mutate(before_after = factor(before_after, levels = c("before Honours","on or after honours"))) %>% 
  add_tally() %>% 
  group_by(before_after, n) %>% 
  tally() %>% 
  filter(!is.na(before_after)) %>% 
  mutate(prop = nn/n) %>% 
  filter()

gender_ba_check_post_wp_chart <- ggplot(gender_before_after_post_wp, aes(gender, prop, fill=gender, text = percent(prop))) +
  geom_col() +
  facet_wrap(~before_after)+
  geom_hline(data=total_before_after_post_wp, aes(yintercept = prop))+
  custom_theme+
  scale_fill_manual(values=colours_gender)+
  scale_y_continuous(labels = percent)+
          labs(title="% of pages created before/after honour for honours issued post start of wikipedia (by gender)", 
             x="Gender", y="Proportion Number of pages")


  
m <- list(
  l = 80,
  r = 150,
  b = 100,
  t = 100,
  pad = 4
)   

gender_ba_check_post_wp_chart_format <- ggplotly(gender_ba_check_post_wp_chart, tooltip="text") 

gender_ba_check_post_wp_chart_format [['x']][['layout']][['annotations']][[2]][['x']] <- -.09
gender_ba_check_post_wp_chart_format [['x']][['layout']][['annotations']][[1]][['y']] <- -.1

gender_ba_check_post_wp_chart_format %>% 
layout(font=t, 
         annotations = 
           list(x = 1, y = -0.2, text = "All Recipients since 15 Jan 2001 with wikipedia page & coded M/F n=2525", 
                showarrow = F, xref='paper', yref='paper', 
                xanchor='right', yanchor='auto', xshift=1, yshift=-2,
                font=list(size=10)),
          autosize=F,
         width=800, 
         height=500,
         margin=m)    
```

#### Summary

* There are only a small representation of Order of Australia recipients on wikipedia, but the higher the order you have the more likely you have a page

* The number of Orders being announced every year is increasing, and the proportion of women receiving awards is increasing, although this is not at parity. The proportion of women and men who have an order and a wikipedia page is a similar ratio overall, but women who have a higher Order level, have a higher chance than average of also having a wikipedia page.

* The announcement of the honours appears to prompt a higher than average number of pages which can be seen on the day and the week of the award. The year an award is announced also has a higher rate of page creation if the sample is limited to those receieving an honour after the start of wkipedia. The intensity of page creation is also high on the week of the announcement for all honours levels and also when looking at gender.

* The rate of pages being created for people holding an award appears to be dropping after a peak of creation in 2005-2006. While the number of awards is increasing the nuber of pages is decreasing. The gap between those that have received an honour, and those that have receievd an honour and have a wikipeida page is widening as page creation declines.
